---
- import_playbook: gather-facts.yml
  when: not skip_gather_fact | bool

- name: Apply role common
  gather_facts: false
  hosts:
    - common
  roles:
    - {
        role: common,
        tags: common,
        when: not skip_common | bool or enable_common | bool,
      }

- name: Apply role haproxy_keepalived
  gather_facts: false
  become: true
  hosts:
    - haproxy_keepalived
  roles:
    - {
        role: haproxy_keepalived,
        tags: haproxy,
        when: enable_haproxy_keepalived | bool,
      }

- name: Apply role prometheus
  gather_facts: false
  become: true
  hosts:
    - prometheus
  roles:
    - {
        role: prometheus,
        tags: prometheus,
        when: enable_prometheus | bool,
      }

- name: Apply role alertmanager
  gather_facts: false
  become: true
  hosts:
    - alertmanager
  roles:
    - {
        role: alertmanager,
        tags: alertmanager,
        when: enable_alertmanager | bool,
      }

- name: Apply role cadvisor
  gather_facts: false
  become: true
  hosts:
    - cadvisor
  roles:
    - {
        role: cadvisor,
        tags: prometheus-exporter,
        when: enable_cadvisor | bool,
      }

- name: Apply role node_exporter
  gather_facts: false
  become: true
  hosts:
    - node_exporter
  roles:
    - {
        role: node_exporter,
        tags: node_exporter,
        when: enable_node_exporter | bool,
      }

- name: Apply role grafana
  gather_facts: false
  become: true
  hosts:
    - grafana
  roles:
    - { role: grafana, tags: grafana, when: enable_grafana | bool }
